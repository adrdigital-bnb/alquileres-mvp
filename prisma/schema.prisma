generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model blocked_dates {
  id          String     @id @default(uuid())
  property_id String
  start_date  DateTime   @db.Date
  end_date    DateTime   @db.Date
  reason      String?    @db.VarChar(255)
  
  // Relaci칩n
  property    properties @relation(fields: [property_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model bookings {
  id             String         @id @default(uuid())
  property_id    String
  guest_id       String
  check_in_date  DateTime       @db.Date
  check_out_date DateTime       @db.Date
  total_price    Decimal        @db.Decimal(10, 2)
  status         booking_status @default(PENDING)
  payment_id     String?        @db.VarChar(255)
  created_at     DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at     DateTime?      @default(now()) @db.Timestamptz(6)
  
  // Relaciones
  guest          users          @relation(fields: [guest_id], references: [id], onUpdate: NoAction)
  property       properties     @relation(fields: [property_id], references: [id], onUpdate: NoAction)

  @@index([property_id, check_in_date, check_out_date], map: "idx_bookings_dates")
}

model properties {
  id              String   @id @default(uuid())
  owner_id        String   // ID del usuario due침o (Clerk ID o User ID interno)
  title           String   @db.VarChar(255)
  description     String?  @db.Text // Cambiado a Text para descripciones largas
  slug            String?  @unique @db.VarChar(255)
  
  // --- UBICACI칍N ---
  address         String   @db.VarChar(255)
  city            String?  @default("Buenos Aires") @db.VarChar(100)
  province        String?  @default("Buenos Aires") @db.VarChar(100) // 游릭 NUEVO: Para el mapa
  neighborhood    String?  @db.VarChar(100)
  zip_code        String?  @db.VarChar(10)
  
  latitude        Float?   // Float es mejor para coordenadas que Decimal
  longitude       Float?   
  
  // --- DETALLES ---
  price_per_night Decimal  @db.Decimal(10, 2)
  max_guests      Int      @default(1)
  bedrooms        Int?     @default(1)
  bathrooms       Int?     @default(1)
  
  // 游릭 MEJORA: Postgres soporta arrays nativos. Es m치s f치cil que JSON.
  amenities       String[] @default([]) 
  images          String[] @default([]) 
  
  whatsapp        String?  @db.VarChar(50) 
  is_active       Boolean? @default(true)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)
   
  // Relaciones
  owner           users           @relation("UserProperties", fields: [owner_id], references: [id])
  blocked_dates   blocked_dates[]
  bookings        bookings[]
   
  @@index([neighborhood], map: "idx_properties_neighborhood")
  @@index([price_per_night], map: "idx_properties_price")
}

model users {
  id            String    @id @default(uuid())
  clerkId       String    @unique 
  email         String    @unique @db.VarChar(255)
  // password_hash String? // 游댮 ELIMINADO: Si usas Clerk, no guardes pass aqu칤 por seguridad/redundancia.
  full_name     String?   @db.VarChar(100) 
  phone         String?   @db.VarChar(50)
  role          user_role @default(GUEST)
  avatar_url    String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)
  
  // Relaciones
  bookings      bookings[] // Reservas que hizo este usuario
  properties    properties[] @relation("UserProperties") // Propiedades que posee este usuario
}

enum booking_status {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum user_role {
  GUEST
  HOST
  ADMIN
}